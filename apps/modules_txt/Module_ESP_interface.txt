Sub  нопка1_Ё÷Ќ_графики()
' функци€ обновлени€ графиков дл€ PVT калькул€тора
'
'
    ' объ€вим вспомогательные массивы дл€ ускорени€ ввода вывода с листа
    Dim q_list() As Variant
    Dim head_list() As Variant
    Dim power_list() As Variant
    Dim eff_list() As Variant
        
    Dim ESP As CESPpump
    Dim ESPsys As CESPsystemSimple
        
    Dim i As Integer  ' итератор
    
    On Error Resume Next
    ' инициализаци€ вспомогательных массивов
    ' дл€ давлений считываютс€ данные по которым будет расчет
    ' дл€ остальных параметров инициализируютс€ только размеры, данные не используютс€
    q_list = Range("ESP_rate_list_").Value2
    ' лист с которого читаем диапазон давлений и по которому стро€тс€ графики разные
    ' чтобы перестроение диапазона изменени€ давлений не испортило графики
    head_list = Range("ESP_head_list_").Value2
    power_list = Range("ESP_head_list_").Value2
    eff_list = Range("ESP_head_list_").Value2
   
    ESP_ID = Range("ESP_ID_").Value2
    ESP_stages = Range("ESP_stages_").Value2
    ESP_freq = Range("ESP_freq_").Value2
    
    Set ESP = getESP(ESP_ID)
    ESP.StageNum = ESP_stages
    ESP.freq_Hz = ESP_freq
    
    ' основной цикл расчета дл€ построени€ графиков
    For i = LBound(q_list) To UBound(q_list)
        q = q_list(i, 1)
        head_list(i, 1) = ESP.Get_ESP_Head_m(q)
        power_list(i, 1) = ESP.Get_ESP_Power_W(q) / 1000
        eff_list(i, 1) = ESP.Get_ESP_effeciency_fr(q)
    Next i
    
    ' записываем расчитанные параметры обратно на лист
    Range("ESP_head_list_") = head_list
    Range("ESP_power_list_") = power_list
    Range("ESP_eff_list_") = eff_list
    
End Sub
