'=======================================================================================
'Unifloc 7.23  coronav                                          khabibullin.ra@gubkin.ru
'Petroleum engineering calculations modules (macroses)
'2000 - 2019
'
'=======================================================================================
'
Option Explicit
'  класс для описания характеристик роторного газосепаратора УЭЦН
'  класс работает с расчетом сепарации вообще - при необходимости описывает входной модуль
'
' геометрические параметры насоса
Private length_m_ As Double                ' длина должна быть не нулевая, для того чтобы корректно строились графики по скважине
Private h_mes_top_ As Double                 ' глубина установки газосепаратора по верхней части
Private d_od_mm_ As Double                   ' внешний диаметр
Private angle_deg_ As Double               ' угол установки УЭЦН (предполагается, что по глубине угол не меняется)
Private d_cas_m_ As Double                  ' диаметр эксплуатационной колонны в месте установки сепаратора
Private q_nom_m3day_                        ' номинальный дебит для газосепаратора
Private p_curve_ As New CInterpolation      ' кривая распределения давления вдоль насоса   (как снаружи, так и внутри)
Private t_curve_ As New CInterpolation      ' кривая распределения температуры флюида вдоль насоса
' общие параметры
Private fluid_ As CPVT                     ' флюид исходный
Private fluid_tub_ As CPVT                  ' флюид после сепарации
Private fluid_cas_ As CPVT                  ' флюид после сепарации - то что идет в затруб
Private is_ksep_manual_ As Boolean           ' флаг для ручного учета газосепаратора
 ' параметры сепарации, расчетные значения
Private ksep_natural_d_ As Double
Private ksep_gassep_d_ As Double
Private ksep_total_d_  As Double
 
Private ksep_gassep_max_d_  As Double
Private q_mix_gassep_rc_m3day_ As Double
Private m_Nm_ As Double                    ' момент потребляемый
Private p_shaft_w_ As Double                ' мощность потребляемая
Private p_shaft_nom_w_ As Double             ' номинальная мощность потребляемая газосепаратором
Private w_rpm_ As Double                   ' скорость вращения вала
Private f_nom_Hz_ As Double                 ' номинальная скорость вращения газосепаратора
 
' свойство для выдачи момента
Public Property Get m_Nm() As Double
   m_Nm = m_Nm_
   m_Nm = p_shaft_w_ / w_radsec
End Property
Public Property Get w_radsec() As Double
   w_radsec = w_rpm_ / 60 * 2 * const_Pi
End Property
Public Property Get w_rpm() As Double
   w_rpm = w_rpm_
End Property
' свойство выдает сумарную кривую по давлениям
Public Property Get p_curve() As CInterpolation
   Set p_curve = p_curve_
End Property
Public Property Get t_curve() As CInterpolation
    Set t_curve = t_curve_
End Property
Public Property Get d_cas_m() As Double
    d_cas_m = d_cas_m_
End Property
'Public Property get Dintake_m() As Double
'    Dintake_m = p_Dintake_m
'End Property
Private Sub Class_Initialize()
    Call init_gassep(OD_mm:=125, _
                Qnom_m3day:=250, _
                h_mes_top_m:=0, _
                d_cas_mm:=0, _
                length_m:=3, _
                angle_deg:=90)
    is_ksep_manual_ = False
    
End Sub
Public Sub init_gassep(Optional OD_mm As Double = 125, _
                  Optional Qnom_m3day As Double = 250, _
                  Optional h_mes_top_m As Double = 0, _
                  Optional angle_deg As Double = 90, _
                  Optional d_cas_mm As Double = 0, _
                  Optional length_m As Double = 1)
' метод инициализации параметров газосепаратора
' в зависимости от габарита
' OD_mm     - определяет габарит
' h_mes_top_m - глубина подвеса в скважине, может пригодится когда то, пока про запас
' Angle_deg - угол установки к горизонтали 90 - вертикально
' d_cas_mm   - диаметр эксплуатационной колоны в месте установки
    d_od_mm_ = OD_mm
    angle_deg_ = angle_deg
    If d_cas_mm = 0 Then
        d_cas_m_ = OD_mm + 10
    Else
        d_cas_m_ = d_cas_mm
    End If
    h_mes_top_ = h_mes_top_m
    length_m_ = length_m
    q_nom_m3day_ = Qnom_m3day
    
    ' пока задаем тут - надо будет в зависимости от модели изменить потом
    p_shaft_nom_w_ = 1000            ' по умолчанию считаем что 1 квт уходит на сепарацию при номинальной частоте
    w_rpm_ = 3000                  ' по умолчанию 3000 оборотов в секунду
    f_nom_Hz_ = 50
    ksep_gassep_max_d_ = 0.9
    
End Sub
' =======================  геометрия
Public Property Get length_m() As Double
    length_m = length_m_
End Property
' глубина установки  (верхняя точка)
Public Property Get h_mes_top_m() As Double
   h_mes_top_m = h_mes_top_
End Property
'Public Property Let h_mes_top_m(val As Double)
'   h_mes_top_ = val
'End Property
' глубина нижней точки установки
Public Property Get h_mes_down_m() As Double
   h_mes_down_m = h_mes_top_m + length_m
End Property
Public Property Get d_od_m() As Double
   d_od_m = d_od_mm_ / 1000
End Property
' угол к горизонтали под которым установлена установка
' угол задается извне системой скважиной при установке системы в скважину
Public Property Get angle_deg() As Double
   angle_deg = angle_deg_
End Property
Public Property Get angle_vert_deg() As Double
   angle_vert_deg = angle_vert_deg - 90
End Property
Public Property Get fluid() As CPVT
   Set fluid = fluid_
End Property
Public Property Get fluid_tub() As CPVT
   Set fluid_tub = fluid_tub_
End Property
Public Property Get fluid_cas() As CPVT
   Set fluid_cas = fluid_cas_
End Property
Public Property Set fluid(val As CPVT)
  Set fluid_ = val       ' берем новый объект в работу
  Set fluid_tub_ = val
  Set fluid_cas_ = val
End Property
Public Property Get is_ksep_manual() As Boolean
   is_ksep_manual = is_ksep_manual_
End Property
Public Property Let is_ksep_manual(val As Boolean)
   is_ksep_manual_ = val
End Property
Public Property Get ksep_fr() As Double
   ksep_fr = ksep_total_d_
End Property
Public Property Let ksep_fr(val As Double)
   ksep_total_d_ = val
End Property
Private Sub Separatefluids()
' метод для принудительного разделения свойст флюида
   ' создаем новые экзампляры
   Set fluid_tub_ = New CPVT
   Set fluid_cas_ = New CPVT
   '  копируем в них значения
   fluid_tub_.Copy fluid_
   fluid_cas_.Copy fluid_
End Sub
Public Sub calc_gassep(pt As PTtype, Optional f_Hz As Double = 50)
' метод расчета параметров газосепаратора при заданных термобарических условиях
' считает, сепарацию, потребляемую мощность, при необходимости другие параметры
' расчитывается естественная и искуственная сепарация, модифицируются флюиды после сепарации
' возвращается значение коэффициента сепарации общего
'
    
    p_curve_.ClearPoints
    t_curve_.ClearPoints
    With fluid
        .calc_PVT_PT pt
        If Not is_ksep_manual Then
            ksep_natural_d_ = calc_NatSeparation_d()
            q_mix_gassep_rc_m3day_ = .qliq_rc_m3day + .q_gas_rc_m3day * (1 - ksep_natural_d_)
            ksep_gassep_d_ = calc_GSsep_d(q_mix_gassep_rc_m3day_)
            ksep_total_d_ = ksep_natural_d_ + (1 - ksep_natural_d_) * ksep_gassep_d_
        End If
    End With
    If ksep_total_d_ > 0 Then
        ' разделяем и модифицируем свойства флюидов после сепарации
        Call Separatefluids
        Call fluid_tub_.mod_after_separation(pt.p_atma, pt.t_C, ksep_total_d_, GasGoesIntoSolution)
        fluid_cas_.qliq_sm3day = 0
    End If
    ' поскольку основная мощность потребляемая газосепаратором тратится шнеком на повышение давления
    ' то можно предположить, что потери мощность с ростом частоты будут расти в кубе
    ' при этом зависимости от дебита выраженной нет, поскольку будет меняться КПД
    ' это предположение требует уточнения (11.07.2018 rnt)
    p_shaft_w_ = p_shaft_nom_w_ * (f_Hz / f_nom_Hz_) ^ 3
    
    ' добавим точки для газосепаратора
    p_curve_.AddPoint h_mes_top_m, pt.p_atma
    p_curve_.AddPoint h_mes_down_m, pt.p_atma
    t_curve_.AddPoint h_mes_top_m, pt.t_C
    t_curve_.AddPoint h_mes_down_m, pt.t_C
    
End Sub
Private Function calc_GSsep_d(q_mix_rc_m3day As Double)
' расчет коэффициента сепарации газосепаратора
' предполагается линейная зависимость от дебита
' q_mix_rc_m3day - расход ГЖС поступающей на вход с учетом естественной сепарации с рабочих условиях
' потом хорошо бы уточнить и приспособить для разных видов конструкции
    Dim KS As Double
    Dim q_mix_ As Double
    Dim qmax As Double
    q_mix_ = q_mix_rc_m3day
    qmax = q_nom_m3day_
    If q_mix_ < qmax Then
        KS = (q_mix_ / qmax) * ksep_gassep_max_d_
    Else
        KS = 0
    End If
    calc_GSsep_d = KS
End Function
Private Function calc_NatSeparation_d() As Double
    With fluid
        calc_NatSeparation_d = unf_natural_separation(d_od_mm_ / 1000, d_cas_m_, _
                                                        .qliq_sm3day, .q_gas_insitu_sm3day, .bo_m3m3, .bg_m3m3, .sigma_oil_gas_Nm, .sigma_wat_gas_Nm, .rho_oil_sckgm3, .rho_gas_sckgm3, .fw_perc)
    End With
End Function
'' метод построения кривой зависимости коэффициента сепарации от дебита
'Public Function Build_SeparCurve()
'
''    Dim i As Integer
''    Dim qtest As Double, Rptest As Double
''    Dim qinit As Double, Rpinit As Double, Rsbinit As Double
''    Dim qmin As Double, Qmax As Double
''    Dim Ks As Double
''    Dim numPoint As Integer
''
''    curve(str_ksep_natQl_curve).ClearPoints
''    curve(str_ksep_gassepQl_curve).ClearPoints
''    curve(str_ksep_totalQl_curve).ClearPoints
''
''    curve(str_ksep_natRp_curve).ClearPoints
''    curve(str_ksep_gassepRp_curve).ClearPoints
''    curve(str_ksep_totalRp_curve).ClearPoints
''
''    numPoint = 20
''
''    qmin = 0: Qmax = 500
''
''    'одолжим ненадолго дебит по скважине
''    qinit = qliq_sm3day
''    Rpinit = fluid.rp_m3m3
''    Rsbinit = fluid.rsb_m3m3
''
''    For i = 0 To numPoint
''        qtest = (Qmax - qmin) / numPoint * i + qmin
''        qliq_sm3day = qtest
''        Ks = calc_SeparationAtIntake_d(p_int_atma_, t_int_C_)
''
''        curve(str_ksep_natQl_curve).AddPoint qtest, ksep_natural_d_
''        curve(str_ksep_gassepQl_curve).AddPoint qtest, ksep_gassep_d_
''        curve(str_ksep_totalQl_curve).AddPoint qtest, ksep_total_d_
''    Next i
''
''    ' вернем дебит по скважине назад
''    qliq_sm3day = qinit
''
''    ' далее построим кривые по сепарации изменяя газовый фактор на скважине
''    Rptest = max(fluid.rsb_m3m3 - 100, 50)
''
''    For i = 0 To numPoint
''        Rptest = Rptest + 10
''        fluid.rp_m3m3 = Rptest
''
''        Ks = calc_SeparationAtIntake_d(p_int_atma_, t_int_C_)
''
''        curve(str_ksep_natRp_curve).AddPoint qtest, ksep_natural_d_
''        curve(str_ksep_gassepRp_curve).AddPoint qtest, ksep_gassep_d_
''        curve(str_ksep_totalRp_curve).AddPoint qtest, ksep_total_d_
''    Next i
''    fluid.rp_m3m3 = Rpinit
''    fluid.rsb_m3m3 = Rsbinit
'
'End Function
'
''
''  МОДУЛЬ РАСЧЕТА КОЭФФИЦИЕНТА СЕПАРАЦИИ
''
'**************************************************************************************************************************
'' ДОСТУПНЫЕ ФУНКЦИИ
' MY_SEPFACTOR  - Вычисление коэффициента сепрации в точке
' MY_INAREA     - Определяет принадлежность точки к измеренной области
' MY_GMIN       - Минимальные замеренные газосодержания для каждого из сепараторов
' MY_GMAX       - Максимальные замеренные газосодержания для каждого из сепараторов
' MY_QMIN       - Минимальные замеренные дебиты для каждого из сепараторов
' MY_QMAX       - Максимальные замеренные дебиты для каждого из сепараторов
' MY_FMIN       - Минимальные замеренные частоты для каждого из сепараторов
' MY_FMAX       - Максимальные замеренные частоты для каждого из сепараторов
'**************************************************************************************************************************
'' ОБЪЯВЛЕНИЯ ДОСТУПНЫХ ФУНКЦИЙ
' Public Function my_sepfactor(SEP_TYPE As Integer, G As Double, Q As Double, F As Double) As Double
' Public Function my_inarea(SEP_TYPE As Integer, G As Double, Q As Double, F As Double, Optional PARAM = "GQF") As Boolean
' Public Function my_gmin(SEP_TYPE As Integer) As Double
' Public Function my_gmax(SEP_TYPE As Integer) As Double
' Public Function my_qmin(SEP_TYPE As Integer) As Double
' Public Function my_qmax(SEP_TYPE As Integer) As Double
' Public Function my_fmin(SEP_TYPE As Integer) As Double
' Public Function my_fmax(SEP_TYPE As Integer) As Double
' Public Function my_theta(SEP_TYPE As Integer, NUM_PAR As Integer) As Double
'**************************************************************************************************************************
'' ПРИМЕЧАНИЕ К АРГУМЕНТАМ ДОСТУПНЫХ ФУНКЦИЙ
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
'   PARAM   - параметры области проверки (default = "GQF")
'
'    "GQF"  - проверка по ГАЗУ, дебитУ, ЧАСТОТЕ
'    "GQ"  - проверка по ГАЗУ, дебитУ
'    "GF"  - проверка по ГАЗУ, ЧАСТОТЕ
'    "QF"  - проверка по дебитУ, ЧАСТОТЕ
'    "G"  - проверка по ГАЗУ
'    "Q"  - проверка по дебитУ
'    "F"  - проверка по ЧАСТОТЕ
'
'**************************************************************************************************************************
Public Function my_sepfactor(SEP_TYPE As Integer, g As Double, q As Double, F As Double) As Double
'
' MY_SEPFACTOR - Вычисление коэффициента сепрации в точке
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
' Переменные для сшивок
Dim MX  As Double
Dim func, dfunc As Double
Dim kA, kB, kC As Double
Dim mX2, r As Double
Dim mD As Double
' Множитель (подобранная константа) для сшивки по дебиту в области максимума
Dim mult As Double
mult = 1.3
'
' ВАЖНО!!!
' Далее: Проверка области идет только по ГАЗОСОДЕРЖАНИЮ и дебитУ
'        Проверки области по ЧАСТОТЕ вообще нет
'
' Если точка лежит в замеренной области, используем аппроксимацию
If (my_inarea(SEP_TYPE, g, q, F, "GQ")) Then
    my_sepfactor = my_sepfactor_approx(SEP_TYPE, g, q, F)
    
End If
' Если точка лежит вне замеренной области, используем сшивки
' (1) Сшивка с параболическим цилиндром только по дебиту в области нуля
If (q < my_qmin(SEP_TYPE)) And (my_inarea(SEP_TYPE, g, q, F, "G")) Then
    MX = my_qmin(SEP_TYPE)
            
    func = my_sepfactor_approx(SEP_TYPE, g, MX, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, g, MX, F, "dQ")
            
    kA = dfunc / MX
    kB = -dfunc
    kC = func
            
    my_sepfactor = kA * q ^ 2 + kB * q + kC
End If
' (2) Сшивка с параболическим цилиндром только по дебиту в области максимума
If (q > my_qmax(SEP_TYPE)) And (my_inarea(SEP_TYPE, g, q, F, "G")) Then
    MX = my_qmax(SEP_TYPE)
            
    ' mQ2
    mX2 = mult * MX
          
    If (q > mX2) Then
        my_sepfactor = 0
            
    Else
        func = my_sepfactor_approx(SEP_TYPE, g, MX, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, g, MX, F, "dQ")
                
        r = MX - mX2
        kA = (dfunc * r - func) / r / r
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        my_sepfactor = kA * q ^ 2 + kB * q + kC
    
    End If
End If
' (3) Сшивка с параболическим цилиндром только по газу в области нуля
If (g < my_gmin(SEP_TYPE)) And (my_inarea(SEP_TYPE, g, q, F, "Q")) Then
    MX = my_gmin(SEP_TYPE)
            
    func = my_sepfactor_approx(SEP_TYPE, MX, q, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, MX, q, F, "dG")
            
    kA = (MX * dfunc - func) / MX / MX
    kB = dfunc - 2 * MX * kA
            
    my_sepfactor = kA * g ^ 2 + kB * g
    
End If
   
' (4) Сшивка с параболическим цилиндром только по газу в области максимума
If (g > my_gmax(SEP_TYPE)) And (my_inarea(SEP_TYPE, g, q, F, "Q")) Then
    MX = my_gmax(SEP_TYPE)
            
    ' mG2
    mX2 = 100
            
    If (g > mX2) Then
        my_sepfactor = 0
            
    Else
        func = my_sepfactor_approx(SEP_TYPE, MX, q, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, MX, q, F, "dG")
                
        r = MX - mX2
        kA = (dfunc * r - func) / r / r
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        my_sepfactor = kA * g ^ 2 + kB * g + kC
    
    End If
End If
' (5) Сшивка с параболоидом вращения по газу в области нуля и по дебиту в области нуля
If (g < my_gmin(SEP_TYPE)) And (q < my_qmin(SEP_TYPE)) Then
    MX = my_qmin(SEP_TYPE)
    mD = my_gmin(SEP_TYPE)
            
    func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
            
    kA = dfunc / MX
    kB = -dfunc
    kC = func
            
    func = kA * q ^ 2 + kB * q + kC
    MX = my_gmin(SEP_TYPE)
    mD = my_qmin(SEP_TYPE)
    
    dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
            
    kA = (MX * dfunc - func) / MX / MX
    kB = dfunc - 2 * MX * kA
            
    my_sepfactor = kA * g ^ 2 + kB * g
    
End If
' (6) Сшивка с параболоидом вращения по газу в области нуля и по дебиту в области максимума
If (g < my_gmin(SEP_TYPE)) And (q > my_qmax(SEP_TYPE)) Then
    MX = my_qmax(SEP_TYPE)
            
    ' mQ2
    mX2 = mult * MX
          
    If (q > mX2) Then
        my_sepfactor = 0
            
    Else
        mD = my_gmin(SEP_TYPE)
        
        func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
                
        r = MX - mX2
        kA = (dfunc * r - func) / r / r
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        func = kA * q ^ 2 + kB * q + kC
    
        MX = my_gmin(SEP_TYPE)
        mD = my_qmax(SEP_TYPE)
    
        dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
            
        kA = (MX * dfunc - func) / MX / MX
        kB = dfunc - 2 * MX * kA
            
        my_sepfactor = kA * g ^ 2 + kB * g
    
    End If
End If
' (7) Сшивка с параболоидом вращения по газу в области максимума и по дебиту в области нуля
If (g > my_gmax(SEP_TYPE)) And (q < my_qmin(SEP_TYPE)) Then
    MX = my_qmin(SEP_TYPE)
    mD = my_gmax(SEP_TYPE)
            
    func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
            
    kA = dfunc / MX
    kB = -dfunc
    kC = func
            
    func = kA * q ^ 2 + kB * q + kC
    
    MX = my_gmax(SEP_TYPE)
    mD = my_qmin(SEP_TYPE)
            
    ' mG2
    mX2 = 100
            
    If (g > mX2) Then
        my_sepfactor = 0
            
    Else
        dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
                
        r = MX - mX2
        kA = (dfunc * r - func) / r / r
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        my_sepfactor = kA * g ^ 2 + kB * g + kC
    
    End If
End If
' (8) Сшивка с параболоидом вращения по газу в области максимума и по дебиту в области максимума
If (g > my_gmax(SEP_TYPE)) And (q > my_qmax(SEP_TYPE)) Then
    MX = my_qmax(SEP_TYPE)
            
    ' mQ2
    mX2 = mult * MX
          
    If (q > mX2) Then
        my_sepfactor = 0
            
    Else
        mD = my_gmax(SEP_TYPE)
        
        func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
                
        r = MX - mX2
        kA = (dfunc * r - func) / r / r
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        func = kA * q ^ 2 + kB * q + kC
    
        MX = my_gmax(SEP_TYPE)
        mD = my_qmax(SEP_TYPE)
            
        ' mG2
        mX2 = 100
            
        If (g > mX2) Then
            my_sepfactor = 0
            
        Else
            dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
                
            r = MX - mX2
            kA = (dfunc * r - func) / r / r
            kB = dfunc - 2 * kA * MX
            kC = -kA * mX2 ^ 2 - kB * mX2
                   
            my_sepfactor = kA * g ^ 2 + kB * g + kC
    
        End If
    
    End If
End If
' Обрезка по значению
If (my_sepfactor < 0) Then
    my_sepfactor = 0
    
End If
If (my_sepfactor > 100) Then
    my_sepfactor = 100
    
End If
End Function
'**************************************************************************************************************************
Public Function my_inarea(SEP_TYPE As Integer, g As Double, q As Double, F As Double, Optional param = "GQF") As Boolean
'
' MY_INAREA - Определяет принадлежность точки к измеренной области
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
'   PARAM   - параметры области проверки (default = "GQF")
'
'    "GQF"  - проверка по ГАЗУ, дебитУ, ЧАСТОТЕ
'    "GQ"  - проверка по ГАЗУ, дебитУ
'    "GF"  - проверка по ГАЗУ, ЧАСТОТЕ
'    "QF"  - проверка по дебитУ, ЧАСТОТЕ
'    "G"  - проверка по ГАЗУ
'    "Q"  - проверка по дебитУ
'    "F"  - проверка по ЧАСТОТЕ
'
my_inarea = True
If (param = "GQF") Or (param = "G") Or (param = "GQ") Or (param = "GF") Then
    If (g < my_gmin(SEP_TYPE)) Or (g > my_gmax(SEP_TYPE)) Then
        my_inarea = False
    End If
End If
If (param = "GQF") Or (param = "Q") Or (param = "GQ") Or (param = "QF") Then
    If (q < my_qmin(SEP_TYPE)) Or (q > my_qmax(SEP_TYPE)) Then
        my_inarea = False
    End If
End If
If (param = "GQF") Or (param = "F") Or (param = "GF") Or (param = "QF") Then
    If (F < my_fmin(SEP_TYPE)) Or (F > my_fmax(SEP_TYPE)) Then
        my_inarea = False
    End If
End If
End Function
'**************************************************************************************************************************
Public Function my_gmin(SEP_TYPE As Integer) As Double
'
' MY_GMIN - Минимальные замеренные газосодержания для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim gmin(1 To 29) As Double
gmin(1) = 6
gmin(2) = 5
gmin(3) = 9
gmin(4) = 8
gmin(5) = 6
gmin(6) = 7
gmin(7) = 10
gmin(8) = 11
gmin(9) = 5
gmin(10) = 6
gmin(11) = 11
gmin(12) = 9
gmin(13) = 11
gmin(14) = 10
gmin(15) = 11
gmin(16) = 11
gmin(17) = 10
gmin(18) = 11
gmin(19) = 5
gmin(20) = 13
gmin(21) = 2
gmin(22) = 2
gmin(23) = 2
gmin(24) = 2
gmin(25) = 2
gmin(26) = 2
gmin(27) = 2
gmin(28) = 2
gmin(29) = 2
my_gmin = gmin(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_gmax(SEP_TYPE As Integer) As Double
'
' MY_GMAX - Максимальные замеренные газосодержания для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim gmax(1 To 29) As Double
gmax(1) = 81
gmax(2) = 75
gmax(3) = 72
gmax(4) = 64
gmax(5) = 66
gmax(6) = 73
gmax(7) = 73
gmax(8) = 73
gmax(9) = 61
gmax(10) = 73
gmax(11) = 69
gmax(12) = 69
gmax(13) = 58
gmax(14) = 62
gmax(15) = 67
gmax(16) = 74
gmax(17) = 73
gmax(18) = 66
gmax(19) = 62
gmax(20) = 74
gmax(21) = 75
gmax(22) = 80
gmax(23) = 80
gmax(24) = 80
gmax(25) = 80
gmax(26) = 90
gmax(27) = 93
gmax(28) = 97
gmax(29) = 99.5
my_gmax = gmax(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_qmin(SEP_TYPE As Integer) As Double
'
' MY_QMIN - Минимальные замеренные дебиты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim qmin(1 To 29) As Double
qmin(1) = 50
qmin(2) = 50
qmin(3) = 80
qmin(4) = 50
qmin(5) = 50
qmin(6) = 50
qmin(7) = 80
qmin(8) = 65
qmin(9) = 50
qmin(10) = 50
qmin(11) = 70
qmin(12) = 50
qmin(13) = 80
qmin(14) = 80
qmin(15) = 80
qmin(16) = 50
qmin(17) = 50
qmin(18) = 50
qmin(19) = 50
qmin(20) = 80
qmin(21) = 10
qmin(22) = 10
qmin(23) = 10
qmin(24) = 10
qmin(25) = 10
qmin(26) = 10
qmin(27) = 10
qmin(28) = 10
qmin(29) = 10
my_qmin = qmin(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_qmax(SEP_TYPE As Integer) As Double
'
' MY_QMAX - Максимальные замеренные дебиты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim qmax(1 To 29) As Double
qmax(1) = 200
qmax(2) = 300
qmax(3) = 350
qmax(4) = 200
qmax(5) = 80
qmax(6) = 200
qmax(7) = 350
qmax(8) = 350
qmax(9) = 200
qmax(10) = 200
qmax(11) = 350
qmax(12) = 200
qmax(13) = 350
qmax(14) = 350
qmax(15) = 350
qmax(16) = 200
qmax(17) = 200
qmax(18) = 200
qmax(19) = 200
qmax(20) = 350
qmax(21) = 250
qmax(22) = 360
qmax(23) = 405
qmax(24) = 650
qmax(25) = 830
qmax(26) = 1300
qmax(27) = 360
qmax(28) = 680
qmax(29) = 2100
my_qmax = qmax(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_fmin(SEP_TYPE As Integer) As Double
'
' MY_FMIN - Минимальные замеренные частоты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim fmin(1 To 29) As Double
fmin(1) = 2037
fmin(2) = 2037
fmin(3) = 2037
fmin(4) = 2037
fmin(5) = 2037
fmin(6) = 2037
fmin(7) = 2037
fmin(8) = 2037
fmin(9) = 2037
fmin(10) = 2037
fmin(11) = 2037
fmin(12) = 2037
fmin(13) = 2037
fmin(14) = 2037
fmin(15) = 2037
fmin(16) = 2037
fmin(17) = 2037
fmin(18) = 2037
fmin(19) = 2037
fmin(20) = 2037
fmin(21) = 2037
fmin(22) = 2037
fmin(23) = 2037
fmin(24) = 2037
fmin(25) = 2037
fmin(26) = 2037
fmin(27) = 2037
fmin(28) = 2037
fmin(29) = 2037
my_fmin = fmin(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_fmax(SEP_TYPE As Integer) As Double
'
' MY_FMAX - Максимальные замеренные частоты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim fmax(1 To 29) As Double
fmax(1) = 4074
fmax(2) = 4074
fmax(3) = 4074
fmax(4) = 4074
fmax(5) = 4074
fmax(6) = 4074
fmax(7) = 4074
fmax(8) = 4074
fmax(9) = 4074
fmax(10) = 4074
fmax(11) = 4074
fmax(12) = 4074
fmax(13) = 4074
fmax(14) = 4074
fmax(15) = 4074
fmax(16) = 4074
fmax(17) = 4074
fmax(18) = 4074
fmax(19) = 4074
fmax(20) = 4074
fmax(21) = 4074
fmax(22) = 4074
fmax(23) = 4074
fmax(24) = 4074
fmax(25) = 4074
fmax(26) = 4074
fmax(27) = 4074
fmax(28) = 4074
fmax(29) = 4074
my_fmax = fmax(SEP_TYPE)
End Function
'**************************************************************************************************************************
Private Function my_sepfactor_approx(SEP_TYPE As Integer, g As Double, q As Double, F As Double, Optional Diff = "0") As Double
'
' MY_SEPFACTOR_APPROX - Вычисление коэффициента сепарации по аппроксимированной зависимости
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
'   DIFF    - параметр отвечающий за тип возвращаемой функции (default = "0")
'
'    "0"    - сама функция
'    "dG"   - частная производная функции по ГАЗОСОДЕРЖАНИЮ
'    "dQ"   - частная производная функции по дебитУ
'    "dF"   - частная производная функции по ЧАСТОТЕ
'
'
' Коэффициенты theta для каждого из сепараторов
'
Dim THETA(29, 12) As Double
' Separator 1
THETA(1, 1) = 0.0000087993
THETA(1, 2) = -0.0014178073
THETA(1, 3) = -0.0000397231
THETA(1, 4) = 0.0529674339
THETA(1, 5) = 0.0028493727
THETA(1, 6) = -0.0001228876
THETA(1, 7) = -0.0003862197
THETA(1, 8) = 0.0000106863
THETA(1, 9) = 0.5323060089
THETA(1, 10) = -0.1045923688
THETA(1, 11) = 0.0042861775
THETA(1, 12) = 53.8027001706
' Separator 2
THETA(2, 1) = -0.0000033628
THETA(2, 2) = -0.000113117
THETA(2, 3) = -0.0000184548
THETA(2, 4) = 0.0379809715
THETA(2, 5) = 0.0002438456
THETA(2, 6) = -0.000187424
THETA(2, 7) = 0.0000051195
THETA(2, 8) = -0.0000281111
THETA(2, 9) = 0.3766056508
THETA(2, 10) = 0.0181773837
THETA(2, 11) = 0.0142218617
THETA(2, 12) = -15.4481969434
' Seperator 3
THETA(3, 1) = 0.0000193145
THETA(3, 2) = -0.0032176704
THETA(3, 3) = -0.0000268557
THETA(3, 4) = 0.1586937256
THETA(3, 5) = 0.001828688
THETA(3, 6) = 0.0000708432
THETA(3, 7) = 0.0000909372
THETA(3, 8) = 0.000002863
THETA(3, 9) = -2.2448483948
THETA(3, 10) = -0.1327032137
THETA(3, 11) = -0.0030459177
THETA(3, 12) = 83.023509036
' Separator 4
THETA(4, 1) = -0.0000121897
THETA(4, 2) = 0.0025164879
THETA(4, 3) = -0.0000028248
THETA(4, 4) = -0.1863706573
THETA(4, 5) = -0.0007591736
THETA(4, 6) = 0.0002146303
THETA(4, 7) = 0.0001319112
THETA(4, 8) = 0.0000187202
THETA(4, 9) = 4.7766561554
THETA(4, 10) = -0.248984867
THETA(4, 11) = -0.0078065695
THETA(4, 12) = 26.2222417751
' Separator 5
THETA(5, 1) = 0.000010823
THETA(5, 2) = -0.0009684032
THETA(5, 3) = 0.0000130572
THETA(5, 4) = -0.0108147984
THETA(5, 5) = -0.0014076182
THETA(5, 6) = -0.00016922
THETA(5, 7) = 0.0007632356
THETA(5, 8) = 0.0000450615
THETA(5, 9) = 2.4191921328
THETA(5, 10) = -0.5524742079
THETA(5, 11) = 0.0039670382
THETA(5, 12) = 36.3660078595
' Separator 6
THETA(6, 1) = 0.0000058748
THETA(6, 2) = -0.0010769325
THETA(6, 3) = -0.0001222593
THETA(6, 4) = 0.0440466354
THETA(6, 5) = 0.0059103956
THETA(6, 6) = -0.0000181232
THETA(6, 7) = -0.0001555878
THETA(6, 8) = -0.0000124109
THETA(6, 9) = 0.7733866636
THETA(6, 10) = -0.118996349
THETA(6, 11) = 0.0028025138
THETA(6, 12) = 37.2251716889
'Separator 7
THETA(7, 1) = 0.000012022
THETA(7, 2) = -0.0017563374
THETA(7, 3) = -0.000064176
THETA(7, 4) = 0.0516750115
THETA(7, 5) = 0.0036795894
THETA(7, 6) = -0.0001779426
THETA(7, 7) = 0.0001613525
THETA(7, 8) = 0.0000084679
THETA(7, 9) = 1.6141781555
THETA(7, 10) = -0.2709599353
THETA(7, 11) = 0.0053775602
THETA(7, 12) = 49.926744881
'Separator 8
THETA(8, 1) = 0.0000116489
THETA(8, 2) = -0.0017284962
THETA(8, 3) = -0.0000885852
THETA(8, 4) = 0.0748456716
THETA(8, 5) = 0.003782259
THETA(8, 6) = 0.0000198235
THETA(8, 7) = 0.00019585
THETA(8, 8) = 0.0000094082
THETA(8, 9) = -0.1554049804
THETA(8, 10) = -0.2084908311
THETA(8, 11) = 0.0000103522
THETA(8, 12) = 55.7924480363
' Separator 9
THETA(9, 1) = -0.0000175932
THETA(9, 2) = 0.0019442256
THETA(9, 3) = 0.000046518
THETA(9, 4) = -0.0915221068
THETA(9, 5) = -0.0045489642
THETA(9, 6) = 0.0001682606
THETA(9, 7) = 0.000113029
THETA(9, 8) = 0.0000093349
THETA(9, 9) = 2.3354157928
THETA(9, 10) = -0.138238023
THETA(9, 11) = -0.0032357402
THETA(9, 12) = 25.9629556167
' Separator 10
THETA(10, 1) = 0.000002168
THETA(10, 2) = -0.000580099
THETA(10, 3) = -0.000029187
THETA(10, 4) = 0.0295065279
THETA(10, 5) = 0.0021737201
THETA(10, 6) = -0.0001052936
THETA(10, 7) = 0.0005934199
THETA(10, 8) = -0.0000239206
THETA(10, 9) = 0.7706293953
THETA(10, 10) = -0.2349725504
THETA(10, 11) = 0.0077944851
THETA(10, 12) = 22.0384189232
' Separator 11
THETA(11, 1) = 0.0000116564
THETA(11, 2) = -0.0020258339
THETA(11, 3) = -0.0000132657
THETA(11, 4) = 0.0995299309
THETA(11, 5) = -0.0007598466
THETA(11, 6) = -0.0000548158
THETA(11, 7) = -0.0000563956
THETA(11, 8) = -0.000010392
THETA(11, 9) = -0.2427459027
THETA(11, 10) = 0.0202310281
THETA(11, 11) = 0.0075101346
THETA(11, 12) = 4.27422002
' Separator 12
THETA(12, 1) = 0.0000056722
THETA(12, 2) = -0.0009737803
THETA(12, 3) = 0.0000005938
THETA(12, 4) = 0.0385538944
THETA(12, 5) = -0.0007528789
THETA(12, 6) = 0.0000842402
THETA(12, 7) = 0.000261956
THETA(12, 8) = -0.0000111876
THETA(12, 9) = 0.6643632145
THETA(12, 10) = -0.1234937687
THETA(12, 11) = -0.0035724804
THETA(12, 12) = 40.793213002
' Separator 13
THETA(13, 1) = 0.0000417791
THETA(13, 2) = -0.0056881068
THETA(13, 3) = 0.0000136645
THETA(13, 4) = 0.2398766601
THETA(13, 5) = -0.0015630531
THETA(13, 6) = -0.0000285158
THETA(13, 7) = -0.0000045129
THETA(13, 8) = -0.0000097042
THETA(13, 9) = -2.1483675056
THETA(13, 10) = 0.0024168463
THETA(13, 11) = 0.002841826
THETA(13, 12) = 15.9686497148
' Separator 14
THETA(14, 1) = 0.0000124079
THETA(14, 2) = -0.0018989305
THETA(14, 3) = -0.0000685307
THETA(14, 4) = 0.0923074028
THETA(14, 5) = 0.0028970542
THETA(14, 6) = 0.0000901038
THETA(14, 7) = -0.0000619527
THETA(14, 8) = 0.000007167
THETA(14, 9) = -1.0808076124
THETA(14, 10) = -0.0810091369
THETA(14, 11) = -0.0071249283
THETA(14, 12) = 67.7249657484
' Separator 15
THETA(15, 1) = 0.0000019904
THETA(15, 2) = -0.0005274256
THETA(15, 3) = -0.0000001321
THETA(15, 4) = 0.0134467294
THETA(15, 5) = -0.0001740387
THETA(15, 6) = 0.0001078648
THETA(15, 7) = 0.000037294
THETA(15, 8) = -0.0000022572
THETA(15, 9) = 1.1347218547
THETA(15, 10) = -0.0796020472
THETA(15, 11) = -0.0092552662
THETA(15, 12) = 58.1899663666
' Separator 16
THETA(16, 1) = -0.0000025266
THETA(16, 2) = 0.00047723
THETA(16, 3) = -0.0000944762
THETA(16, 4) = -0.0398647861
THETA(16, 5) = 0.0041625028
THETA(16, 6) = -0.000070289
THETA(16, 7) = 0.0009218642
THETA(16, 8) = 0.0000009868
THETA(16, 9) = 2.3891544407
THETA(16, 10) = -0.4062646547
THETA(16, 11) = -0.001223861
THETA(16, 12) = 46.3205673503
' Separator 17
THETA(17, 1) = 0.0000070011
THETA(17, 2) = -0.0011447747
THETA(17, 3) = -0.0000773086
THETA(17, 4) = 0.0451625345
THETA(17, 5) = 0.0050233714
THETA(17, 6) = 0.0001828168
THETA(17, 7) = 0.0001230263
THETA(17, 8) = 0.000026509
THETA(17, 9) = 0.2681015918
THETA(17, 10) = -0.2887132557
THETA(17, 11) = -0.0155483915
THETA(17, 12) = 82.5608915421
' Separator 18
THETA(18, 1) = 0.0000131145
THETA(18, 2) = -0.0020218787
THETA(18, 3) = -0.0000752502
THETA(18, 4) = 0.0889028466
THETA(18, 5) = 0.002430388
THETA(18, 6) = 0.0000726508
THETA(18, 7) = 0.0006097805
THETA(18, 8) = 0.0000283123
THETA(18, 9) = -0.9279795475
THETA(18, 10) = -0.4347461705
THETA(18, 11) = -0.0039938935
THETA(18, 12) = 93.9145436659
' Separator 19
THETA(19, 1) = 0.0000085993
THETA(19, 2) = -0.0012006374
THETA(19, 3) = 0.0000199194
THETA(19, 4) = 0.0153486403
THETA(19, 5) = -0.0011703937
THETA(19, 6) = 0.0001431831
THETA(19, 7) = -0.0001461161
THETA(19, 8) = 0.000014851
THETA(19, 9) = 1.6030972398
THETA(19, 10) = -0.1368893957
THETA(19, 11) = -0.0037610015
THETA(19, 12) = 37.8893186113
' Separator 20
THETA(20, 1) = 0.0000052149
THETA(20, 2) = -0.0008542311
THETA(20, 3) = 0.0000188589
THETA(20, 4) = 0.0270391744
THETA(20, 5) = -0.0018547051
THETA(20, 6) = -0.0000847238
THETA(20, 7) = -0.0001708993
THETA(20, 8) = 0.0000330029
THETA(20, 9) = 1.0747595188
THETA(20, 10) = -0.2605626409
THETA(20, 11) = -0.004685222
THETA(20, 12) = 78.1426121405
' Separator 21
THETA(21, 1) = -0.0000057686
THETA(21, 2) = 0.0017841804
THETA(21, 3) = 0.0001483174
THETA(21, 4) = -0.2064464015
THETA(21, 5) = -0.0219079147
THETA(21, 6) = -0.0000000207
THETA(21, 7) = -0.0000164214
THETA(21, 8) = -0.0000000065
THETA(21, 9) = 8.8977452453
THETA(21, 10) = 0.2993764227
THETA(21, 11) = 0.0000023453
THETA(21, 12) = 26.5902172049
' Separator 22
THETA(22, 1) = -0.0000148823
THETA(22, 2) = 0.0031307273
THETA(22, 3) = 0.0001281999
THETA(22, 4) = -0.2532762045
THETA(22, 5) = -0.0165203227
THETA(22, 6) = 0.0000000001
THETA(22, 7) = 0.0000364149
THETA(22, 8) = 0.0000000001
THETA(22, 9) = 8.6246826085
THETA(22, 10) = 0.2111779388
THETA(22, 11) = -0.000000021
THETA(22, 12) = 29.5491379611
' Separator 23
THETA(23, 1) = -0.0000104298
THETA(23, 2) = 0.002208906
THETA(23, 3) = 0.00011223
THETA(23, 4) = -0.1895447082
THETA(23, 5) = -0.0146300899
THETA(23, 6) = -0.0000000012
THETA(23, 7) = 0.0001615412
THETA(23, 8) = -0.0000000002
THETA(23, 9) = 7.0218835769
THETA(23, 10) = 0.1291558283
THETA(23, 11) = 0.0000001235
THETA(23, 12) = 43.5724349818
' Separator 24
THETA(24, 1) = -0.0000112867
THETA(24, 2) = 0.0028143661
THETA(24, 3) = 0.0000373215
THETA(24, 4) = -0.2574502614
THETA(24, 5) = -0.0058632671
THETA(24, 6) = 0.0000000005
THETA(24, 7) = -0.0000035432
THETA(24, 8) = 0.0000000002
THETA(24, 9) = 9.0898405078
THETA(24, 10) = 0.0944206556
THETA(24, 11) = -0.0000001149
THETA(24, 12) = 28.8052225675
' Separator 25
THETA(25, 1) = -0.0000047317
THETA(25, 2) = 0.0014358247
THETA(25, 3) = 0.0000360452
THETA(25, 4) = -0.1647687447
THETA(25, 5) = -0.0052902961
THETA(25, 6) = 0.0000000002
THETA(25, 7) = -0.000023142
THETA(25, 8) = 0
THETA(25, 9) = 6.9898540248
THETA(25, 10) = 0.0937383503
THETA(25, 11) = -0.0000000372
THETA(25, 12) = 38.5321169147
' Separator 26
THETA(26, 1) = -0.0000066665
THETA(26, 2) = 0.0016477688
THETA(26, 3) = 0.0000234341
THETA(26, 4) = -0.1609884272
THETA(26, 5) = -0.0034313902
THETA(26, 6) = -0.0000000017
THETA(26, 7) = 0.0000039671
THETA(26, 8) = -0.0000000001
THETA(26, 9) = 6.2720389162
THETA(26, 10) = 0.043843296
THETA(26, 11) = 0.0000001602
THETA(26, 12) = 48.4084469733
' Separator 27
THETA(27, 1) = -0.0000133811
THETA(27, 2) = 0.003036567
THETA(27, 3) = 0.000086037
THETA(27, 4) = -0.2611712442
THETA(27, 5) = -0.0125172084
THETA(27, 6) = -0.0000000021
THETA(27, 7) = 0.0000545221
THETA(27, 8) = -0.0000000003
THETA(27, 9) = 9.0760388084
THETA(27, 10) = 0.1543012733
THETA(27, 11) = 0.0000002117
THETA(27, 12) = 32.0977307469
' Separator 28
THETA(28, 1) = -0.0000125759
THETA(28, 2) = 0.0028445982
THETA(28, 3) = 0.0000370209
THETA(28, 4) = -0.2395693671
THETA(28, 5) = -0.0056313278
THETA(28, 6) = 0.0000000003
THETA(28, 7) = 0.0000484194
THETA(28, 8) = 0
THETA(28, 9) = 8.0537813544
THETA(28, 10) = 0.0446873619
THETA(28, 11) = -0.0000000348
THETA(28, 12) = 45.0662007633
' Separator 29
THETA(29, 1) = -0.0000019919
THETA(29, 2) = 0.0006438949
THETA(29, 3) = 0.0000134658
THETA(29, 4) = -0.0903471166
THETA(29, 5) = -0.0020142629
THETA(29, 6) = -0.0000000004
THETA(29, 7) = 0.0000019207
THETA(29, 8) = 0
THETA(29, 9) = 4.5220839775
THETA(29, 10) = 0.0248272635
THETA(29, 11) = 0.0000000365
THETA(29, 12) = 58.3191138042
' Вычисление функции по аппроксимации
If (Diff = "0") Then
    my_sepfactor_approx = THETA(SEP_TYPE, 1) * g ^ 4 + THETA(SEP_TYPE, 2) * g ^ 3 + THETA(SEP_TYPE, 3) * g ^ 2 * q + THETA(SEP_TYPE, 4) * g ^ 2 + THETA(SEP_TYPE, 5) * g * q + THETA(SEP_TYPE, 6) * g * F + THETA(SEP_TYPE, 7) * q ^ 2 + THETA(SEP_TYPE, 8) * q * F + THETA(SEP_TYPE, 9) * g + THETA(SEP_TYPE, 10) * q + THETA(SEP_TYPE, 11) * F + THETA(SEP_TYPE, 12)
    
End If
' Вычисление производной функции по ГАЗОСОДЕРЖАНИЮ
If (Diff = "dG") Then
    my_sepfactor_approx = 4 * THETA(SEP_TYPE, 1) * g ^ 3 + 3 * THETA(SEP_TYPE, 2) * g ^ 2 + 2 * THETA(SEP_TYPE, 3) * g * q + 2 * THETA(SEP_TYPE, 4) * g + THETA(SEP_TYPE, 5) * q + THETA(SEP_TYPE, 6) * F + THETA(SEP_TYPE, 9)
    
End If
' Вычисление производной функции по дебитУ
If (Diff = "dQ") Then
    my_sepfactor_approx = THETA(SEP_TYPE, 3) * g ^ 2 + THETA(SEP_TYPE, 5) * g + 2 * THETA(SEP_TYPE, 7) * q + THETA(SEP_TYPE, 8) * F + THETA(SEP_TYPE, 10)
    
End If
' Вычисление производной функции по ЧАСТОТЕ
If (Diff = "dF") Then
    my_sepfactor_approx = THETA(SEP_TYPE, 6) * g + THETA(SEP_TYPE, 8) * q + THETA(SEP_TYPE, 11)
    
End If
End Function
'**************************************************************************************************************************
''[EOF]
Public Function Separator_Name(Code As Integer) As String
Select Case Code
Case 1
Separator_Name = "GDNK5"
Case 2
Separator_Name = "VGSA (VORTEX)"
Case 3
Separator_Name = "GDNK5A"
Case 4
Separator_Name = "GSA5-1"
Case 5
Separator_Name = "GSA5-3"
Case 6
Separator_Name = "GSA5-4"
Case 7
Separator_Name = "GSAN-5A"
Case 8
Separator_Name = "GSD-5A"
Case 9
Separator_Name = "GSD5"
Case 10
Separator_Name = "3MNGB5"
Case 11
Separator_Name = "3MNGB5A"
Case 12
Separator_Name = "3MNGDB5"
Case 13
Separator_Name = "3MNGDB5A"
Case 14
Separator_Name = "MNGSL5A-M"
Case 15
Separator_Name = "MNGSL5A-TM"
Case 16
Separator_Name = "MNGSL5-M"
Case 17
Separator_Name = "MNGSL5-TM"
Case 18
Separator_Name = "MNGSLM 5"
Case 19
Separator_Name = "MNGD 5"
Case 20
Separator_Name = "GSIK 5A"
Case 21
Separator_Name = "338DSR"
Case 22
Separator_Name = "400GSR"
Case 23
Separator_Name = "400GSV"
Case 24
Separator_Name = "400GSVHV"
Case 25
Separator_Name = "538 GSR"
Case 26
Separator_Name = "538 GSVHV"
Case 27
Separator_Name = "400FSR(OLD)"
Case 28
Separator_Name = "513GRS(OLD)"
Case 29
Separator_Name = "675HRS"
Case Else
Separator_Name = "Н/Д"
End Select
End Function

