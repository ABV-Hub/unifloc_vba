'=======================================================================================
'Unifloc7.5  Boinae                                           khabibullin.ra@gubkin.ru
'Библиотека расчетных модулей по нефтяному инжинирингу
'2000 - 2019 гг
'
'=======================================================================================
'
' Gaslift valve set
'
' will provide initialisation methods
Public valves As New Collection_
Public Property Get Count() As Integer
' return number of actual valves in well
    Count = valves.Count
End Property
Public Property Get Hmes_m(i As Integer) As Double
    On Error GoTo er1:
    Hmes_m = valves(i).Hmes_m
    Exit Property
er1:
    Hmes_m = 0
End Property
Public Sub InitOneValve(Hmes_m, dvalve_mm)
    Dim vlv As New CGLvalve
    vlv.Hmes_m = Hmes_m
    vlv.d_mm = dvalve_mm
    valves.RemoveAll
    valves.Add vlv
End Sub
Public Sub LoadFromVertRange(RangX As Range, RangY As Range)
' load GLVs from vertical range.
' range читаются по вертикали - значения должны быть в строках - столбец должен быть только один
' должна использоваться для чтения исходных данных с листа
'
    Dim i As Integer
    Dim NumVal As Integer
    Dim Hm_m As Double, dvlv_mm As Double
    Dim vlv As CGLvalve
    
    NumVal = min(RangX.Rows.Count, RangY.Rows.Count)
    If NumVal < 0 Then Err.Raise 1, , "Не удалось прочитать кривую"
    ' читаем поэлементно, чтобы отсеять пустые ячейки по пути
    On Error Resume Next
    For i = 1 To NumVal
        Hm_m = RangX.Value2(i, 1)
        dvlv_mm = RangY.Value2(i, 1)
        If (i = 1) Or (Hm_m > 0) Then
            Set vlv = New CGLvalve
            vlv.Hmes_m = Hm_m
            vlv.d_mm = dvlv_mm
            valves.Add vlv
        End If
    Next i
End Sub
