''=======================================================================================
''Unifloc 7.12  Apodemus agrarius                                           khabibullin.ra@gubkin.ru
''Petroleum engineering calculations modules (macroses)
''2000 - 2019
''
''=======================================================================================
''
'' класс для решения прикладных задач (верхний уровень)
'' здесь должны формировать и формулироваться задачи которые должна решать система
''
''
'Option Explicit
'
'
'Public fluid As CPVT
'
'Public fluid_norma As CPVT      ' для того чтобы сохранить дебит из расчета нормального
'
'Public WithEvents PS As CProdSystem_old   ' система добычи, которая собственно и проводит прикладные расчеты
'
'Public WithEvents PS_norma As CProdSystem_old
'
'' набор полей описывающих систему
'
'Public Event ReportProgress(msg As String)
'
' ' блок оценки качества данных
' 'Public' LogMsg As CLogger                 ' логгер
'
'
'
'Private Sub Class_Initialize()
'' конструктор для класса - тут создаем готовый объект с данными по умолчанию, чтобы можно было его использовать
'
'  Set PS = New CProdSystem_old
'  Set PS_norma = New CProdSystem_old
'
'  Set fluid = New CPVT
'  Set fluid_norma = New CPVT
'
'  Set PS.fluid = fluid
'  Set PS_norma.fluid = fluid_norma
'
''  'Set' LogMsg = getLogMsg
'' '' LogMsg.ClearAll
''
''  Set PS.LogMsg =' LogMsg
''  Set PS_norma.LogMsg =' LogMsg
'
'
'
'End Sub
'
'Public Sub SetESP(name As String, Rate, head, power, Eff, Optional ByVal Hz As Double = 50, Optional ByVal Stages As Integer = 1)
'    Call p_SetESP(PS, name, Rate, head, power, Eff, Hz, Stages, fluid)
'    Call p_SetESP(PS_norma, name, Rate, head, power, Eff, Hz, Stages, fluid_norma)
'
'End Sub
'
'Private Sub p_SetESP(PrSys As CProdSystem_old, name As String, Rate, head, power, Eff, Optional ByVal Hz As Double = 50, Optional ByVal Stages As Integer = 1, Optional fl As CPVT)
'    Set PrSys.well.ESP = New CESPsystemSimple
'    Set PrSys.well.ESP.fluid = fl
''    Call PrSys.well.ESP.loadESP_points(name, Rate, head, power, Eff)
''
''    PrSys.well.ESP.stage_num = Stages
''    PrSys.well.ESP.freq_Hz = Hz
'
'End Sub
'
''Public Sub SetConstruction(h_mes_m, h_vert_m, d_cas_m, d_tub_m, Optional d_choke_m As Double = -1, Optional arr_roughness_m = 0.0001)
''' метод инициализации конструкции
''    Call p_SetConstruction(PS, h_mes_m, h_vert_m, d_cas_m, d_tub_m, d_choke_m, arr_roughness_m)
''    Call p_SetConstruction(PS_norma, h_mes_m, h_vert_m, d_cas_m, d_tub_m, d_choke_m, arr_roughness_m)
''
''End Sub
''
''Private Sub p_SetConstruction(PrSys As CProdSystem_old, h_mes_m, h_vert_m, d_cas_m, d_tub_m, Optional d_choke_m As Double = -1, Optional arr_roughness_m = 0.0001)
''' метод инициализации конструкции
''    Call PrSys.well.InitWell(h_mes_m, h_vert_m, d_cas_m, d_tub_m)
''
''    If d_choke_m >= 0 Then PrSys.well.d_choke_m = d_choke_m
''
''End Sub
'
'
'Public Sub SetReservoir(Optional ByVal Pres_atma = -1, Optional ByVal pi_sm3dayatm = -1)
'' метод инициализации конструкции скважины
'
'    Call p_SetReservoir(PS, Pres_atma, pi_sm3dayatm)
'    Call p_SetReservoir(PS_norma, Pres_atma, pi_sm3dayatm)
'
'End Sub
'
'Private Sub p_SetReservoir(PrSys As CProdSystem_old, Optional ByVal Pres_atma = -1, Optional ByVal pi_sm3dayatm = -1)
'' метод инициализации конструкции скважины
'
'    If Pres_atma > 0 Then PrSys.Reservoir.Pres_atma = Pres_atma
'    If pi_sm3dayatm > 0 Then PrSys.Reservoir.pi_sm3dayatm = pi_sm3dayatm
'
'
'End Sub
'
'Public Sub SetPVT(Optional ByVal rp_m3m3 As Double = -1, Optional ByVal rsb_m3m3 As Double = -1, _
'                  Optional ByVal gamma_gas = -1, Optional ByVal gamma_oil = -1, Optional ByVal gamma_water As Double = 1, _
'                  Optional ByVal pb_atma As Double = -1, Optional bob_m3m3 As Double = -1)
'' метод инициализации PVT свойств
'' можно дополнительно задать только те параметры которые нужны, если какие то параметры не будут заданы, то будут использованы значения по умолчанию
'    Call p_SetPVT(fluid, rp_m3m3, rsb_m3m3, gamma_gas, gamma_oil, gamma_water, pb_atma, bob_m3m3)
'    Call p_SetPVT(fluid_norma, rp_m3m3, rsb_m3m3, gamma_gas, gamma_oil, gamma_water, pb_atma, bob_m3m3)
'
'End Sub
'
'Private Sub p_SetPVT(fl As CPVT, _
'                  Optional ByVal rp_m3m3 As Double = -1, Optional ByVal rsb_m3m3 As Double = -1, _
'                  Optional ByVal gamma_gas = -1, Optional ByVal gamma_oil = -1, Optional ByVal gamma_water As Double = 1, _
'                  Optional ByVal pb_atma As Double = -1, Optional bob_m3m3 As Double = -1)
'' метод инициализации PVT свойств
'' можно дополнительно задать только те параметры которые нужны, если какие то параметры не будут заданы, то будут использованы значения по умолчанию
'    If rp_m3m3 > 0 Then
'        If rsb_m3m3 < 0 Then rsb_m3m3 = rp_m3m3   ' если использовано значение по умолчанию тогда его сбрасываем
'        fl.set_rp_rsb rp_m3m3, rsb_m3m3
'    End If
'    If gamma_gas > 0 Then fl.gamma_g = gamma_gas
'    If gamma_oil > 0 Then fl.gamma_o = gamma_oil
'    If gamma_water > 0 Then fl.gamma_w = gamma_water
'
'    If pb_atma > 0 Then fl.pb_atma = pb_atma
'    If bob_m3m3 > 0 Then fl.bob_m3m3 = bob_m3m3
'
'
'
'End Sub
'
'
'
'Public Sub CalcAnalysis(ByVal QliQtest_sm3day As Double, ByVal fw_perc As Double, ByVal plin_atma As Double, ByVal pbuf_atma As Double, _
'                         Optional ByVal pwf_atma As Double = -1, Optional ByVal t_bh_C As Double = -1, _
'                         Optional p_int_atma As Double = -1, Optional h_dyn_m As Double = -1, Optional p_an_atma As Double = -1, _
'                         Optional CalcForecast As Boolean = False, Optional calcFast As Boolean = False)
'' расчет анализа скважины на текущий режим работы
'' fluid.qliq_sm3day = QliQtest_sm3day
'' fluid.fw_perc = fw_perc
' On Error Resume Next
'
' Call PS.calc_Analysis(QliQtest_sm3day, fw_perc, plin_atma, pbuf_atma, pwf_atma, t_bh_C, p_int_atma, t_bh_C, h_dyn_m, p_an_atma)
'
' PS_norma.Reservoir.pi_sm3dayatm = PS.Reservoir.pi_sm3dayatm
' PS_norma.fluid.fw_perc = fw_perc
'
' Call PS_norma.calc_Forecast(plin_atma, t_bh_C)
'
' 'Call' LogMsg.SaveToFile
'
'End Sub
'
'Public Sub CalcForecast()
'' расчет прогноза на измеренный режим работы
'
'End Sub
'
'Public Sub CalcDesign()
'' расчет дизайна оборудования на заданные условия
'
'End Sub
'
'Private Sub PS_norma_ReportProgress(msg As String)
'' передадим событие полученное от ПродСистемы наверх
'    RaiseEvent ReportProgress("norm | " & msg)
'    addLogMsg "norm | " & msg, msgLog
'End Sub
'
'Private Sub PS_ReportProgress(msg As String)
'' передадим событие полученное от ПродСистемы наверх
'    RaiseEvent ReportProgress(msg)
'    addLogMsg msg, msgLog
'End Sub

