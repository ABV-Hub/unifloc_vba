'=======================================================================================
'Unifloc 7.10  Apodemus agrarius                                           khabibullin.ra@gubkin.ru
'Petroleum engineering calculations modules (macroses)
'2000 - 2019
'
'=======================================================================================
'
Option Explicit
' класс для описания свойств пласта
Implements IReservoir
' параметры флюида
 
 Private pi_sm3dayatm_ As Double
 Private p_res_atma_ As Double
 
 Private fluid_ As CPVT
 ' флюид нужен чтобы определить давление насыщения и обводненность
 
 
 Private IPR_curve_ As CInterpolation
 ' блок оценки качества данных
 'Public' LogMsg As New CLogger                ' логгер
 Public Sub InitProp(Pres_atma, pb_atma, fw_perc)
 '   p_fw_perc = fw_perc
    p_res_atma_ = Pres_atma
 '   pb_atma_ = pb_atma
    
    Set fluid = New CPVT
    
    fluid.pb_atma = pb_atma
    fluid.fw_perc = fw_perc
 
 End Sub
 
 Public Property Get fluid() As CPVT
    Set fluid = fluid_
 End Property
 
 Public Property Set fluid(val As CPVT)
    Set fluid_ = val
 End Property
 
 Public Property Get pb_atma() As Double
    pb_atma = fluid.pb_atma
 End Property
 
 Public Property Get fw_perc() As Double
    fw_perc = fluid.fw_perc
 End Property
 
 
 Property Get IPRCurve() As CInterpolation
    IPRCurve = IPR_curve_
 End Property
 
 Property Let pi_sm3dayatm(pi_val As Double)
    pi_sm3dayatm_ = pi_val
 End Property
 
 Property Get pi_sm3dayatm() As Double
   pi_sm3dayatm = pi_sm3dayatm_
 End Property
Public Property Get Pres_atma() As Double
    Pres_atma = p_res_atma_
End Property
Public Property Let Pres_atma(val As Double)
    p_res_atma_ = val
End Property
Public Function calc_q_liq_sm3day(ByVal Ptest_atma As Double)
 calc_q_liq_sm3day = calc_Q_IPR_m3Day(Ptest_atma, Pres_atma, pb_atma, pi_sm3dayatm, fw_perc)
End Function
Public Function calc_p_wf_atma(ByVal qtest As Double)
 
 calc_p_wf_atma = calc_p_wf_IPres_atma(qtest, Pres_atma, pb_atma, pi_sm3dayatm, fw_perc)
End Function
Public Function calc_pi_sm3dayatm(ByVal qtest As Double, ByVal Ptest As Double)
pi_sm3dayatm = calc_pi_IPR_m3DayAtm(qtest, Ptest, Pres_atma, pb_atma, fw_perc)
calc_pi_sm3dayatm = pi_sm3dayatm
End Function
Public Function Build_IPRcurve() As CInterpolation
    Set IPR_curve_ = New CInterpolation
    
    Const IPRNumPoints = 30
    
    Dim i As Integer
    Dim Qstep As Double
    Dim p_wf As Double
    Dim Qliq_reserv As Double
    Dim maxQ As Double
    
    maxQ = calc_q_liq_sm3day(0)
    
    
    
    Qstep = maxQ / IPRNumPoints
    
    For i = 0 To IPRNumPoints
     
     p_wf = calc_p_wf_atma(i * Qstep)
     IPR_curve_.AddPoint i * Qstep, p_wf
     
    Next i
        
    Set Build_IPRcurve = IPR_curve_
End Function
Private Sub Class_Initialize()
  'Set' LogMsg = getLogMsg
End Sub
Private Function IReservoir_CalcPI(ByVal qtest As Double, ByVal Ptest As Double) As Variant
    IReservoir_CalcPI = calc_pi_sm3dayatm(qtest, Ptest)
End Function
Private Function IReservoir_CalcPwf(ByVal qtest As Double) As Variant
    IReservoir_CalcPwf = calc_p_wf_atma(qtest)
End Function
Private Function IReservoir_CalcQliq(ByVal Ptest_atma As Double) As Variant
    IReservoir_CalcQliq = calc_q_liq_sm3day(Ptest_atma)
End Function
Private Property Let IReservoir_pi(RHS As Double)
    pi_sm3dayatm_ = RHS
End Property
Private Property Get IReservoir_pi() As Double
    IReservoir_pi = pi_sm3dayatm_
End Property
Private Property Let IReservoir_Pres(RHS As Double)
    p_res_atma_ = RHS
End Property
Private Property Get IReservoir_Pres() As Double
    IReservoir_Pres = p_res_atma_
End Property
