'=======================================================================================
'Unifloc 7.11  Apodemus agrarius                                           khabibullin.ra@gubkin.ru
'Petroleum engineering calculations modules (macroses)
'2000 - 2019
'
'=======================================================================================
'
'  Clogger - класс описывающий объект логирования и контроля качества расчетов
'  Logger живет паралельно с расчетныим классами и умеет принимать от них сообщения о нештатных ситуациях при проведении расчетов
'           он копит информацию и теоретически может ее анализировать и строить статистику
'
Option Explicit
Public MsgList As New Collection    ' список всех сообщений об ошибках
Public Sub ClearAll()
 Set MsgList = Nothing
 Set MsgList = New Collection
End Sub
 ' функция для передачи сообщения о предупреждении или ошибки для обработки
 ' параметры
 '      - описание ошибки
 '      - уровень ошибки  - критическая ошибка, предупреждение, коррекция данных
 '      - контекст в котором вызвана ошибка - название функции, тип расчета который ведется (как собрать? можно сделать общий параметр у класса отвественный за контекст проведения расчета)
 
 
 Public Function AddMsg(msg As String) As Long
   
  On Error Resume Next
   Dim lm As CLogMsg
   Set lm = New CLogMsg    ' создали новый объект
   
   lm.name = msg
   MsgList.Add lm          ' добавляем сообщение в список
   AddMsg = MsgList.Count
 
 End Function
Public Function SaveToFile()
    Dim FullFileName As String
    Dim dir As String
    Dim FSO As FileSystemObject, ts As TextStream, fil As file
    
    FullFileName = ThisWorkbook.Path & "\" & "oppump.log"
    Set FSO = CreateObject("scripting.filesystemobject")
    
    If FSO.FileExists(FullFileName) Then Kill FullFileName
    
    Set ts = FSO.OpenTextFile(FullFileName, ForWriting, True)
    Dim ST As CLogMsg
    
On Error Resume Next
    ' on english version office - russian letter can cause file write error here
    For Each ST In MsgList
        ts.WriteLine ST.TypeErr & " " & ST.name:
    Next
    
    ts.Close: Set ts = Nothing: Set FSO = Nothing
End Function
