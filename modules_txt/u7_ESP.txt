'=======================================================================================
'Unifloc 7.17  Test                                          khabibullin.ra@gubkin.ru
'Petroleum engineering calculations modules (macroses)
'2000 - 2019
'
'=======================================================================================
' Работа с базой насосов и погружного оборудования
'
Option Explicit
' набор глобоальный объектов создаваемых в памяти при работе с базой насосов
' глобальные переменные позволяют загрузить один раз базу и работать с ней
' без необходимости постоянно перезагружать ее с листа Excel
Public ESPbase As CESPBase
Public ESP As CESPpump
Public ESPsys As New CESPsystemSimple
Public motor As New CESPMotor
Const ESP_db_name = "ESP.db"
Public Function loadESPbase() As Boolean
' загрузка насоса с нужным ID из базы насосов
    Dim numESP As Integer
On Error GoTo err1:
    addLogMsg "Загружаем базу насосов"
    
    Set ESPbase = New CESPBase
    ESPbase.load_db_file_ESP ThisWorkbook.Path & "\" & ESP_db_name
    numESP = ESPbase.num_pumps
    addLogMsg "Базу насосов загрузили, всего найдено " & numESP & " насосов"
    loadESPbase = True
    Exit Function
err1:
    addLogMsg "Не удалось загрузить базу насосов. " & Err.Description
    loadESPbase = False
End Function
Public Function checkID_ESP(ID) As Boolean
' проверка соотвествует ли переданный ID тому который загружен во временную переменную
On Error GoTo err1:
    If ESP Is Nothing Then
        If Not loadESPbase Then checkID_ESP = False
        Set ESP = ESPbase.get_pump(ID) ' ESPcollection.Item(CStr(ID))
        checkID_ESP = True
    End If
    If ESP.db.ID = ID Then
        checkID_ESP = True
    Else
        Set ESP = ESPbase.get_pump(ID) ' ESPcollection.Item(CStr(ID))
        checkID_ESP = True
    End If
Exit Function
err1:
    addLogMsg "Ошибка при проверке насоса ID " & ID & " ."
    checkID_ESP = False
End Function
Public Function getESP(ID) As CESPpump
' возвращает ЭЦН с заданным номером из базы
    Dim newESP As New CESPpump
    If checkID_ESP(ID) Then
        Call newESP.Copy(ESP)
        Set getESP = newESP
    End If
End Function
Public Function checkID_Motor(ID) As Boolean
    checkID_Motor = True
End Function
Public Function get_motor(ID) As CESPMotor
' возвращает Двигатель для ЭЦН с заданным номером из базы
End Function
Public Function checkID_Cable(ID) As Boolean
    checkID_Cable = True
End Function
Public Function checkID_GasSep(ID) As Boolean
    checkID_GasSep = True
End Function
Public Function getGasSep(ID) As CESPGasSep
' возвращает газосепаратор для УЭЦН с заданным номером из базы
End Function

